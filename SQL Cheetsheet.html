<!DOCTYPE html>
<html>

<head>
  <title>SQL Cheatsheet</title>
</head>
<style>
  body {
    background-color: #CEDCB6;
    margin-left: 200px;
    font-family: Garamond, Helvetica, sans-serif;
  }
  div {
    line-height: 150%;
    margin-left: 10px;
  }
  .keyword {
    color: #326A1C;
    font-size: 20px;
    font-weight: 600;
    display: inline-block;
    width: 120px;
    margin-left: -20px;
    margin-right: 20px;
    text-align: right;
  }
  input {
    border-width: 0;
    font-family: Technic, "Times New Roman",serif;
    text-align: center;
    background-color: #E1E7D5;
  }
  .necessaryInput {
    background-color: white;
  }
  h1 {
    padding-top: 30px;
    color: #2F3E26;
    font-size: 50px;
    text-decoration-line: underline;
    text-decoration-thickness: 3px;
  }
  h2 {
    color: #758F76;
    font-size: 22px;
  }
  h3 {
    font-size: 28px;
    text-decoration-line: overline;
    text-decoration-thickness: 2px;
    padding-top: 25px;
    margin-left: -10px;
    text-shadow: 0 0 3px darkgreen;
  }
  h4{
    font-size: 20px;
    color: #7F6000;
  }
  p {
    border: 2px solid #5D7D4B;
    background-color: beige;
    padding: 3px 10px 10px;
    height: 60px;
    width: 500px;
    line-height: 125%;
    margin-left: 10px;
    font-family: serif, Cambria;
  }
  .generate {
    border: 1px solid #000000;
    font-family: Garamond, Helvetica, sans-serif;
    font-size: 18px;
    color: white;
    background-color: #5D7D4B;
    width: 85px;
    height: 25px;
    margin-left: 10px;
  }
  .comment {
    color: #2F3E26;
    font-size: 14px;
  }
  .add {
    border: 1px solid #5D7D4B;
    font-family: Technic, Helvetica, sans-serif;
    background-color: #9CBB73;
  }
  .add:active {
    background-color: #6D8C44;
  }
  select {
    font-family: Technic, sans-serif;
    background-color: #E1E7D5;
  }
</style>

  <body>

  <h1>SQL Cheatsheet</h1>
  <h2> Author: Ehaema / ehaema@umich.edu</h2>
  <h3>SELECT statement</h3>
  <div>
    <span id="groupComment2" class="comment" style="visibility: hidden; position: absolute; top: 270px; left: 330px"> <b>*"SELECT" should only contain aggregate functions and Group Field(s)!</b></span>
    <span class="keyword"> SELECT </span>
    <label for="fieldName"></label>
    <input class=leftInput type="text" id="fieldName" value="*" size = "10" onchange="activeField('fieldName')">
    <label for="aggregate"></label>
    <select style="color: gray" id="aggregate" onchange="showAggregate()">
      <option style="color: gray" value="default" selected>Add aggregate function...</option>
      <option value="SUM">Sum</option>
      <option value="AVG">Average</option>
      <option value="COUNT">Count</option>
      <option value="MAX">Maximum</option>
      <option value="MIN">Minimum</option>
      <option value="STDEV">Standard Deviation</option>
    </select>
    <label for="aggregatedField"></label>
    <input style = "visibility: hidden" type="text" id="aggregatedField" placeholder="Aggregated Field" onchange="activeField('aggregatedField')">
    <button style = "visibility: hidden" class="add" id=addAggregate type="button" onclick="addAggregate()">
      Add
    </button>
  </div>
  <div>
    <span class="keyword"> FROM </span>
    <label for="tableName"></label>
    <input class=necessaryInput type="text" id="tableName" placeholder="Table Name" size = "15">
  </div>
  <div>
    <span class="keyword"> WHERE </span>
    <label for="lhs"></label>
    <input class=necessaryInput type="text" id="lhs" placeholder="Filter Field" size = "10">
    <label for="conditionType"></label>
    <select id="conditionType" onchange="changeConditionList('conditionType', 'condition')">
      <option value="number" selected>Number</option>
      <option value="text">Text</option>
      <option value="date">Date</option>
      <option value="other">Other...</option>
    </select>
    <label for="condition"></label>
      <select id="condition" onchange="activeField('condition')">
      <option value="=" selected>=</option>
      <option value=">=">>=</option>
      <option value="<="><=</option>
      <option value="!=">Not equal to</option>
    </select>
    <label for="rhs"></label>
    <input class=necessaryInput type="text" id="rhs" placeholder="Value" size = "7">
    <label for="addFilter"></label>
    <button style="margin-left:30px" id="addFilter" class="add" type="button" onclick="addFilter()">Add another filter</button>
    <br>
    <label for="filterRelation"></label>
    <select style="display: none; width: 120px;text-align: right;border-color: #5D7D4B; background-color: #9CBB73" id="filterRelation">
      <option value="AND" selected>And</option>
      <option value="OR">Or</option>
    </select>
    <label for="lhs_1"></label>
    <input class=leftInput style="display: none;" type="text" id="lhs_1" placeholder="Filter Field" size="10" onchange="activeField('lhs_1')">
    <label for="conditionType_1"></label>
    <select style="display: none;" id="conditionType_1" onchange="changeConditionList('conditionType_1', 'condition_1')">
      <option value="number" selected>Number</option>
      <option value="text">Text</option>
      <option value="date">Date</option>
      <option value="other">Other...</option>
    </select>
    <label for="condition_1"></label>
    <select style="display: none;" id="condition_1" onchange="activeField('condition_1')">
      <option value="=" selected>=</option>
      <option value=">=">>=</option>
      <option value="<="><=</option>
      <option value="!=">Not equal to</option>
    </select>
    <label for="rhs_1"></label>
    <input type="text" style="display: none;" id="rhs_1" placeholder="Value" size = "7" onchange="activeField('rhs_1')">
  </div>
  <div>
    <span class="keyword" id="groupBy" style="color: gray"> GROUP BY</span>
    <label for="groupField"></label>
    <input class=leftInput type="text" id="groupField" placeholder="Group Field" size = "10" onchange="activeKeyword('groupField', 'groupBy')">
    <span id="groupComment1" class = "comment" style="margin-left: 10px; color: gray"> *All records with the same "Group Field" will be combined together.</span>
    <label for="addGroupFilter"></label>
    <button style="margin-left:10px; visibility: hidden" id="addGroupFilter" class="add" type="button" onclick="addAggregateFilter()">Add aggregate filter</button>
    <br>
    <span class="keyword" style="display: none;" id="having"> HAVING</span>
    <label for="havingLhs"></label>
    <input class=leftInput style="display: none;" type="text" id="havingLhs" placeholder="Aggregate Function" onchange="activeField('havingLhs')">
    <label for="havingCondition"></label>
    <select style="display: none;" id="havingCondition" onchange="activeField('havingCondition')">
      <option value="=" selected>=</option>
      <option value=">=">>=</option>
      <option value="<="><=</option>
      <option value="!=">Not equal to</option>
    </select>
    <label for="havingRhs"></label>
    <input style="display: none;" type="text" id="havingRhs" placeholder="Value" size="7" onchange="activeField('havingRhs')">
  </div>
  <div>
    <span class="keyword" id="orderBy" style="color: gray"> ORDER BY</span>
    <label for="orderField"></label>
    <input class=leftInput type="text" id="orderField" placeholder="Order Field" size = "10" onchange="activeKeyword('orderField', 'orderBy')">
    <label for="orderType"></label>
    <select style="visibility: hidden" id="orderType" onchange="activeField('orderType')">
      <option value="DESC" selected>Descending</option>
      <option value="ASC">Ascending</option>
    </select>
  </div>

  <button class=generate id=generateSelection type="button" onclick="showOutput()" onmousedown="copying('generateSelection')" onmouseup="copied('generateSelection')">
    Generate
  </button>

  <p id="output">Input <u>Table Name</u>, <u>Filter Field</u> and <u>Value</u> to get the simplest query.</p>

  <h3>Pre-porgrammed Queries</h3>
  <h4>Get LiCA ZONE group number:</h4>
  <div>
    <span class="keyword" style="width: 100px">AREA</span>
    <label for="areaName"></label>
    <input class="necessaryInput" type="text" id="areaName" size = "9">
    <button class=generate id=generateArea type="button" onclick="showAreaOutput()" onmousedown="copying('generateArea')" onmouseup="copied('generateArea')" style="margin-left: 50px">
      Generate
    </button>
  </div>
  <h4>Check duplicate CSO names:</h4>
  <p id="checkCSO">SELECT name, endpoint, COUNT(*) AS duplicant FROM devices WHERE type = 'xicatoDevice' AND name LIKE '^AA' GROUP BY name, endpoint HAVING COUNT(*)>1</p>
  <h4>Check duplicate CSO names:</h4>
  <p id="deleteCSO">DELETE FROM devices WHERE ID NOT IN ( SELECT MIN(id) FROM public.devices GROUP BY name ) AND type = 'xicatoDevice' AND name ~* '^AA'</p>

  <script>
  function showOutput() {
    let output = "SELECT " + document.getElementById("fieldName").value
               + " FROM " + document.getElementById("tableName").value
               + " WHERE " + document.getElementById("lhs").value + " " + generateCondition("conditionType", "condition", "rhs");
    if (document.getElementById("addFilter").style.color === "gray") output += " " + document.getElementById("filterRelation").value + " " + document.getElementById("lhs_1").value + " " + generateCondition("conditionType_1", "condition_1", "rhs_1");
    if (activeKeyword('groupField','groupBy')) output += " GROUP BY " + document.getElementById("groupField").value;
    if (document.getElementById("addGroupFilter").style.color === 'gray') output += " HAVING " + document.getElementById("havingLhs").value + " " + document.getElementById("havingCondition").value + " " + document.getElementById("havingRhs").value;
    if (activeKeyword('orderField','orderBy')) output += " ORDER BY " + document.getElementById("orderField").value + " " + document.getElementById("orderType").value;
    document.getElementById("output").innerHTML = output;
    navigator.clipboard.writeText(output);
  }
  function showAreaOutput() {
    let output = "SELECT zone.name, xicato_group.id FROM zone, xicato_group WHERE " //todo
    navigator.clipboard.writeText(output);
  }
  function changeConditionList(filterTypeName, filterName) {
    document.getElementById(filterTypeName).style.backgroundColor = 'white';
    let items;
    switch(document.getElementById(filterTypeName).value) {
      case "number":
        items = ["=",">=", "<=", "not equal to"];
        break;
      case "text":
        items = ["is", "includes", "customize regular expression"];
        break;
      case "date":
        items = ["is", "before", "after"];
        break;
      default:
        items = ["="];
    }
    let str = ""
    for (let item of items) {
      str += "<option value=\"" + item + "\">" + item + "</option>"
    }
    document.getElementById(filterName).innerHTML = str;
  }
  function generateCondition(filterTypeName, filterName, rhs) {
    const condition = document.getElementById(filterName).value;
    switch(document.getElementById(filterTypeName).value) {
      case "number":
        if (condition === "not equal to")  return " <> " + document.getElementById(rhs).value;
        else                               return condition + " " + document.getElementById(rhs).value;
      case "text":
        if (condition === "is")             return " = \"" + document.getElementById(rhs).value + "\"";
        else if (condition === "includes") return " LIKE \"*" + document.getElementById(rhs).value + "*\"";
        else                               return " LIKE \"" + document.getElementById(rhs).value + "\"";
      case "date":
        if (condition === "is") return " = datevalue(\"" + document.getElementById(rhs).value + "\"";
        else if (condition === "before") return " < datevalue(\"" + document.getElementById(rhs).value + "\"";
        else return " > datevalue(\"" + document.getElementById(rhs).value + "\"";
      default:
        return condition + document.getElementById(rhs).value;
    }
  }
  function copying(buttonID) {
    document.getElementById(buttonID).innerHTML = "Copied!";
    document.getElementById(buttonID).style.backgroundColor = "#8AC543";
    document.getElementById(buttonID).style.color = "#385723";
    document.getElementById(buttonID).style.fontStyle = "italic";
  }
  function copied(buttonID) {
    document.getElementById(buttonID).innerHTML = "Generate";
    document.getElementById(buttonID).style.backgroundColor = "#5D7D4B";
    document.getElementById(buttonID).style.color = "white";
    document.getElementById(buttonID).style.fontStyle = "normal";
  }
  function showAggregate() {
    if (document.getElementById("aggregate").value === "default") {
      document.getElementById("aggregate").style.backgroundColor = '#E1E7D5';
      document.getElementById("aggregatedField").style.visibility = "hidden";
      document.getElementById("addAggregate").style.visibility = "hidden";
      document.getElementById("aggregate").style.color = "gray";
    }
    else {
      document.getElementById("aggregate").style.backgroundColor = 'white';
      document.getElementById("aggregatedField").style.visibility = "visible";
      document.getElementById("addAggregate").style.visibility = "visible";
      document.getElementById("aggregate").style.color = "black";
    }
  }
  function addAggregate() {
    document.getElementById("fieldName").value = document.getElementById("fieldName").value.concat(", ", document.getElementById("aggregate").value, "(", document.getElementById("aggregatedField").value, ") AS ", document.getElementById("aggregate").value.toLowerCase(), "Num");
  }
  function activeKeyword(fieldName, keyword) {
    document.getElementById(fieldName).style.backgroundColor = 'white';
    const orderField = document.getElementById(fieldName).value;
    if (orderField.length === 0) {
      document.getElementById(keyword).style.color = "gray";
      if (keyword==="orderBy") document.getElementById("orderType").style.visibility = "hidden";
      if (keyword==="groupBy") {
        document.getElementById("groupComment1").style.color = "gray";
        document.getElementById("groupComment2").style.visibility = "hidden";
        document.getElementById("addGroupFilter").style.visibility = "hidden"
      }
      return 0;
    }
    else {
      document.getElementById(keyword).style.color = "#326A1C";
      if (keyword==="orderBy") document.getElementById("orderType").style.visibility = "visible";
      if (keyword==="groupBy") {
        document.getElementById("groupComment1").style.color = "#2F3E26";
        document.getElementById("groupComment2").style.visibility = "visible";
        document.getElementById("addGroupFilter").style.visibility = "visible"
      }
      return 1;
    }
  }
  function addFilter() {
    if (document.getElementById("addFilter").style.color === 'gray') return;
    document.getElementById("filterRelation").style.display = "inline-block";
    document.getElementById("lhs_1").style.display = "inline-block";
    document.getElementById("conditionType_1").style.display = "inline-block";
    document.getElementById("condition_1").style.display = "inline-block";
    document.getElementById("rhs_1").style.display = "inline-block";
    document.getElementById("addFilter").style.color = 'gray';
  }
  function addAggregateFilter() {
    if (document.getElementById("addGroupFilter").style.color === 'gray') return;
    document.getElementById("having").style.display = "inline-block";
    document.getElementById("havingLhs").style.display = "inline-block";
    document.getElementById("havingCondition").style.display = "inline-block";
    document.getElementById("havingRhs").style.display = "inline-block";
    document.getElementById("addGroupFilter").style.color = 'gray';
  }
  function activeField(inputID) {
    document.getElementById(inputID).style.backgroundColor = 'white';
  }
  </script>

</body>
</html>